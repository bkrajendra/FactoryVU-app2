<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Settings</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="settings-content">
    <section class="section">
      <h2>Cloud API</h2>
      <ion-item lines="full">
        <ion-icon name="key-outline" slot="start"></ion-icon>
        <ion-input
          label="API Key"
          labelPlacement="stacked"
          [value]="apiKeyInput"
          (ionInput)="onApiKeyInput($any($event).detail.value ?? '')"
          type="password"
          placeholder="Enter your API key"
          autocomplete="off"></ion-input>
      </ion-item>
      <div class="api-key-actions">
        <ion-button
          expand="block"
          (click)="saveApiKey()"
          [disabled]="!hasUnsavedChanges">
          <ion-icon name="save-outline" slot="start"></ion-icon>
          Save API Key
        </ion-button>
        <ion-text *ngIf="saveMessage" color="success" class="save-message">
          <p>{{ saveMessage }}</p>
        </ion-text>
        <ion-text *ngIf="hasUnsavedChanges" color="warning" class="unsaved-message">
          <p>You have unsaved changes</p>
        </ion-text>
      </div>
    </section>

    <section class="section">
      <h2>Notifications</h2>
      <ion-item lines="full">
        <ion-icon name="chatbubble-outline" slot="start"></ion-icon>
        <ion-label>SMS notifications</ion-label>
        <ion-toggle
          [checked]="(notificationSms$ | async) ?? true"
          (ionChange)="setSms($any($event).detail.checked)"
          slot="end"></ion-toggle>
      </ion-item>
      <ion-item lines="full">
        <ion-icon name="mail-outline" slot="start"></ion-icon>
        <ion-label>Email notifications</ion-label>
        <ion-toggle
          [checked]="(notificationEmail$ | async) ?? true"
          (ionChange)="setEmail($any($event).detail.checked)"
          slot="end"></ion-toggle>
      </ion-item>
    </section>

    <section class="section">
      <h2>Temperature Thresholds (Â°C)</h2>
      <ion-item lines="full">
        <ion-icon name="thermometer-outline" slot="start"></ion-icon>
        <ion-input
          label="Upper Limit"
          labelPlacement="stacked"
          type="number"
          [(ngModel)]="tempUpper"
          (ionInput)="onThresholdChange()"
          placeholder="35"></ion-input>
      </ion-item>
      <ion-item lines="full">
        <ion-icon name="thermometer-outline" slot="start"></ion-icon>
        <ion-input
          label="Lower Limit"
          labelPlacement="stacked"
          type="number"
          [(ngModel)]="tempLower"
          (ionInput)="onThresholdChange()"
          placeholder="15"></ion-input>
      </ion-item>
    </section>

    <section class="section">
      <h2>Humidity Thresholds (%)</h2>
      <ion-item lines="full">
        <ion-icon name="water-outline" slot="start"></ion-icon>
        <ion-input
          label="Upper Limit"
          labelPlacement="stacked"
          type="number"
          [(ngModel)]="humidityUpper"
          (ionInput)="onThresholdChange()"
          placeholder="80"></ion-input>
      </ion-item>
      <ion-item lines="full">
        <ion-icon name="water-outline" slot="start"></ion-icon>
        <ion-input
          label="Lower Limit"
          labelPlacement="stacked"
          type="number"
          [(ngModel)]="humidityLower"
          (ionInput)="onThresholdChange()"
          placeholder="30"></ion-input>
      </ion-item>
    </section>

    <section class="section">
      <h2>Graph Settings</h2>
      <ion-item lines="full">
        <ion-icon name="time-outline" slot="start"></ion-icon>
        <ion-input
          label="Update Interval (seconds)"
          labelPlacement="stacked"
          type="number"
          [(ngModel)]="updateIntervalInput"
          (ionInput)="onThresholdChange()"
          placeholder="5"
          min="1"></ion-input>
      </ion-item>
      <div class="api-key-actions">
        <ion-button
          expand="block"
          (click)="saveThresholds()"
          [disabled]="!hasUnsavedThresholds">
          <ion-icon name="save-outline" slot="start"></ion-icon>
          Save Settings
        </ion-button>
        <ion-text *ngIf="thresholdMessage" color="success" class="save-message">
          <p>{{ thresholdMessage }}</p>
        </ion-text>
        <ion-text *ngIf="hasUnsavedThresholds" color="warning" class="unsaved-message">
          <p>You have unsaved changes</p>
        </ion-text>
      </div>
    </section>
  </div>
</ion-content>
